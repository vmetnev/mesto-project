(()=>{"use strict";var e="",t="";function n(t){e=t.target}function r(e){t=e.target}function o(n){var r=n.target;r.classList.contains("popup_opened")&&e===t&&m(r)}function i(e){"Escape"===e.key&&m(document.querySelector(".popup_opened"))}var a={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!0};function u(e){var t=document.querySelector(e.formSelector);t.addEventListener("submit",c),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){e.validationAtOpen&&s(e,t,n),n.addEventListener("input",(function(){s(e,t,n)}))})),p(e,t)}function c(e){e.preventDefault(),e.currentTarget.checkValidity()}function l(e){if(e){var t=e.querySelector("button");if("submit"===t.getAttribute("type")){var n=Array.from(e.querySelectorAll("input")),r=!0;n.forEach((function(e){e.setCustomValidity(""),e.classList.remove("popup__input_type_error"),e.nextElementSibling.textContent="",e.value||(r=!1)})),r?(t.disabled=!1,t.classList.remove(a.inactiveButtonClass)):(t.disabled=!0,t.classList.add(a.inactiveButtonClass))}}}function s(e,t,n){n.validity.valid||(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.patternError):t.setCustomValidity("")}(0,n),function(e,t){t.nextElementSibling.textContent=t.validationMessage,t.classList.add(e.inputErrorClass)}(e,n),p(e,t)),n.validity.valid&&(n.nextElementSibling.textContent="",n.classList.remove(e.inputErrorClass),p(e,t))}function p(e,t){var n=t.querySelector(e.submitButtonSelector);t.checkValidity()?(n.removeAttribute("disabled"),n.classList.remove(e.inactiveButtonClass)):(n.setAttribute("disabled",!0),n.classList.add(e.inactiveButtonClass))}function d(e){e.classList.add("popup_opened"),document.body.addEventListener("keydown",i),e.addEventListener("mousedown",n),e.addEventListener("mouseup",r),e.addEventListener("click",o)}function m(e){e.classList.remove("popup_opened"),e.removeEventListener("click",o),e.removeEventListener("mousedown",n),e.removeEventListener("mouseup",r),document.body.removeEventListener("keydown",i)}function f(e){m(e.target.closest(".popup"))}function _(e,t){e.textContent=t}var v={baseUrl:"https://nomoreparties.co/v1/plus-cohort-21/",headers:{authorization:"883b0527-2256-47ba-8282-90ca954558f2","Content-Type":"application/json"}};function y(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))}function h(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"server",a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=e.querySelector(".element").cloneNode(!0),c=u.querySelector(".element__image"),l=u.querySelector(".element__delete");return u.setAttribute("_id",t),u.querySelector(".element__text").textContent=n,u.querySelector(".element__likes").textContent=o,a&&u.querySelector(".element__heart").classList.add("element__heart_active"),l.style.visibility="server"==i?"hidden":"visible",c.src=r,c.alt=n,c.addEventListener("click",(function(e){!function(e,t){d(document.querySelector(".view")),k.src=e.target.src,k.alt=e.target.alt,x.textContent=e.target.alt}(e)})),u.querySelector(".element__delete").addEventListener("click",E),u.querySelector(".element__heart").addEventListener("click",C),u}var b=document.querySelector(".confirm"),S=b.querySelector(".confirm__form"),q=b.querySelector(".confirm__submit");S.addEventListener("submit",(function(e){e.preventDefault();var t,n=!1;_(q,"Удаление..."),(t=g,fetch("".concat(v.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:v.headers}).then(y)).then((function(e){document.querySelector('[_id="'.concat(g,'"]')).remove(),_(q,"Удалено")})).catch((function(e){n=!0,console.log(e),_(q,"Ошибка"),setTimeout((function(){_(q,"Да")}),2e3)})).finally((function(){n||(setTimeout((function(){_(q,"Да")}),2e3),m(b),g="")}))})),S.addEventListener("keydown",(function(){}));var g="";function E(e){g=e.target.closest(".element").getAttribute("_id"),d(b),S.querySelector(".confirm__input").focus()}function C(e){var t,n=e.target,r=n.closest(".element"),o=r.querySelector(".element__likes"),i=r.getAttribute("_id");n.classList.contains("element__heart_active")?function(e){return fetch("".concat(v.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:v.headers}).then(y)}(i).then((function(e){n.classList.toggle("element__heart_active"),o.textContent=e.likes.length})).catch((function(e){console.log(e)})):(t=i,fetch("".concat(v.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:v.headers}).then(y)).then((function(e){n.classList.toggle("element__heart_active"),o.textContent=e.likes.length})).catch((function(e){console.log(e)}))}var L=document.querySelector(".view"),k=L.querySelector(".view__image"),x=L.querySelector(".view__text");function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w=document.querySelector(".profile"),T=w.querySelector(".profile__image-holder"),B=w.querySelector(".profile__avatar"),O=w.querySelector(".profile__title"),U=w.querySelector(".profile__text"),j=w.querySelector(".profile__edit-button"),D=document.querySelector(".edit"),P=D.querySelector(".edit__form"),V=P.querySelector(".edit__submit"),N=D.querySelector('input[name="form-name"]'),I=D.querySelector('input[name="form-profession"]'),J=document.querySelector(".update"),M=J.querySelector(".update__form"),z=M.querySelector("input"),G=M.querySelector(".update__submit");M.addEventListener("submit",(function(e){var t;e.preventDefault(),_(G,"Сохранение..."),(t={avatar:z.value},fetch("".concat(v.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:v.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))}))).then((function(e){B.src=z.value,_(G,"Сохранено"),m(J)})).catch((function(e){_(G,"Ошибка"),console.log(e)})).finally((function(){setTimeout((function(){_(G,"Сохранить")}),1e3)}))})),T.addEventListener("click",(function(){M.reset(),l(M),d(J)}));var H=document.querySelector(".elements"),Z=document.querySelector("#card-template").content;Promise.all([fetch("".concat(v.baseUrl,"/users/me"),{method:"GET",headers:v.headers}).then(y),fetch("".concat(v.baseUrl,"/cards"),{method:"GET",headers:v.headers}).then(y)]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,u=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(u.push(r.value),u.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1],a=/[^A-Za-zА-ЯЁа-яё\- ]/g;O.textContent=o.name.replace(a,""),U.textContent=o.about.replace(a,""),B.src=o.avatar;var u="server",c=!1;i.forEach((function(e){u=e.owner.name===O.textContent?"own":"server",e.likes.forEach((function(e){e.name===O.textContent&&(c=!0)})),H.append(h(Z,e._id,e.name,e.link,e.likes.length,u,c)),c=!1}))})).catch((function(e){console.log(e)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",f)}));var $=document.querySelector(".new-item"),F=document.querySelector(".new-item__form"),K=document.querySelector(".new-item__submit"),Q=F.querySelector('input[name="item-text"]'),R=F.querySelector('input[name="item-link"]');F.addEventListener("submit",(function(e){e.preventDefault();var t,n=!1;_(K,"Сохранение..."),(t={name:Q.value,link:R.value},fetch("".concat(v.baseUrl,"/cards"),{method:"POST",headers:v.headers,body:JSON.stringify(t)}).then(y)).then((function(e){H.prepend(h(Z,e._id,e.name,e.link,e.likes.length,"own")),_(K,"Сохранено")})).catch((function(e){n=!0,console.log(e),_(K,"Ошибка"),setTimeout((function(){_(K,"Сохранить")}),2e3)})).finally((function(){n?setTimeout((function(){_(K,"Сохранить")}),2e3):(setTimeout((function(){_(K,"Сохранить")}),2e3),m($),F.reset())}))}));var W=w.querySelector(".profile__add-button");P.addEventListener("submit",(function(e){e.preventDefault();var t,n=!1;O.textContent!==N.value||U.textContent!==I.value?(O.textContent=N.value,U.textContent=I.value,_(V,"Сохранение..."),(t={name:N.value,about:I.value},fetch("".concat(v.baseUrl,"/users/me"),{method:"PATCH",headers:v.headers,body:JSON.stringify(t)}).then(y)).then((function(e){_(V,"Сохранено")})).catch((function(e){n=!0,console.log(e),_(V,"Ошибка")})).finally((function(){n||m(D),setTimeout((function(){_(V,"Сохранить")}),1e3)}))):m(D)})),j.addEventListener("click",(function(){P.reset(),l(P),N.value=O.textContent,I.value=U.textContent,d(D)})),W.addEventListener("click",(function(){F.reset(),l(F),d($)})),u({formSelector:'.popup__form[name="form-edit-profile"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!0}),u({formSelector:'.popup__form[name="form-new-item"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!1}),u({formSelector:'.popup__form[name="form-update-avatar"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!0})})();