(()=>{"use strict";var e="",t="";function n(t){e=t.target}function o(e){t=e.target}function r(n){var o=n.target;o.classList.contains("popup_opened")&&e===t&&m(o)}function i(e){"Escape"===e.key&&m(document.querySelector(".popup_opened"))}var c={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!0};function u(e){var t=document.querySelector(e.formSelector);t.addEventListener("submit",a),Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){e.validationAtOpen&&l(e,t,n),n.addEventListener("input",(function(){l(e,t,n)}))})),p(e,t)}function a(e){e.preventDefault(),e.currentTarget.checkValidity()}function s(e){if(e){var t=e.querySelector("button");if("submit"===t.getAttribute("type")){var n=Array.from(e.querySelectorAll("input")),o=!0;n.forEach((function(e){e.setCustomValidity(""),e.classList.remove("popup__input_type_error"),e.nextElementSibling.textContent="",e.value||(o=!1)})),o?(t.disabled=!1,t.classList.remove(c.inactiveButtonClass)):(t.disabled=!0,t.classList.add(c.inactiveButtonClass))}}}function l(e,t,n){n.validity.valid||(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.patternError):t.setCustomValidity("")}(0,n),function(e,t){t.nextElementSibling.textContent=t.validationMessage,t.classList.add(e.inputErrorClass)}(e,n),p(e,t)),n.validity.valid&&(n.nextElementSibling.textContent="",n.classList.remove(e.inputErrorClass),p(e,t))}function p(e,t){var n=t.querySelector(e.submitButtonSelector);t.checkValidity()?(n.removeAttribute("disabled"),n.classList.remove(e.inactiveButtonClass)):(n.setAttribute("disabled",!0),n.classList.add(e.inactiveButtonClass))}function d(e){e.classList.add("popup_opened"),document.body.addEventListener("keydown",i),e.addEventListener("mousedown",n),e.addEventListener("mouseup",o),e.addEventListener("click",r)}function m(e){e.classList.remove("popup_opened"),e.removeEventListener("click",r),e.removeEventListener("mousedown",n),e.removeEventListener("mouseup",o),document.body.removeEventListener("keydown",i)}function _(e){m(e.target.closest(".popup"))}function f(e){e.textContent="Сохранение..."}function v(e){e.textContent="Сохранено"}function h(e){e.textContent="Сохранить"}var y={baseUrl:"https://nomoreparties.co/v1/plus-cohort-21/",headers:{authorization:"883b0527-2256-47ba-8282-90ca954558f2","Content-Type":"application/json"}};function S(e,t,n,o,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"server",c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=e.querySelector(".element").cloneNode(!0),a=u.querySelector(".element__image"),s=u.querySelector(".element__delete");return u.setAttribute("_id",t),u.querySelector(".element__text").textContent=n,u.querySelector(".element__likes").textContent=r,c&&u.querySelector(".element__heart").classList.add("element__heart_active"),s.style.visibility="server"==i?"hidden":"visible",a.src=o,a.alt=n,a.addEventListener("click",(function(e){!function(e,t){d(document.querySelector(".view")),k.src=e.target.src,k.alt=e.target.alt,x.textContent=e.target.alt}(e)})),u.querySelector(".element__delete").addEventListener("click",C),u.querySelector(".element__heart").addEventListener("click",g),u}var b=document.querySelector(".confirm"),q=b.querySelector(".confirm__form");b.querySelector(".confirm__submit"),q.addEventListener("submit",(function(e){var t;e.preventDefault(),document.querySelector('[_id="'.concat(E,'"]')).remove(),m(b),t=E,fetch("".concat(y.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))})),E=""})),q.addEventListener("keydown",(function(){}));var E="";function C(e){E=e.target.closest(".element").getAttribute("_id"),d(b),q.querySelector(".confirm__input").focus()}function g(e){var t,n=e.target,o=n.closest(".element"),r=o.querySelector(".element__likes"),i=o.getAttribute("_id");n.classList.toggle("element__heart_active"),n.classList.contains("element__heart_active")?(t=i,fetch("".concat(y.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))}))).then((function(e){r.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(y.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))}))}(i).then((function(e){r.textContent=e.likes.length})).catch((function(e){console.log(e)}))}var L=document.querySelector(".view"),k=L.querySelector(".view__image"),x=L.querySelector(".view__text"),A=document.querySelector(".profile"),j=A.querySelector(".profile__image-holder"),w=A.querySelector(".profile__avatar"),B=A.querySelector(".profile__title"),T=A.querySelector(".profile__text"),P=A.querySelector(".profile__edit-button"),U=document.querySelector(".edit"),O=U.querySelector(".edit__form"),D=O.querySelector(".edit__submit"),V=U.querySelector('input[name="form-name"]'),N=U.querySelector('input[name="form-profession"]'),J=document.querySelector(".update"),z=J.querySelector(".update__form"),G=z.querySelector("input"),H=z.querySelector(".update__submit");z.addEventListener("submit",(function(e){var t;e.preventDefault(),f(H),(t={avatar:G.value},fetch("".concat(y.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:y.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))}))).then((function(e){v(H),setTimeout((function(){h(H)}),1e3)})).catch((function(e){return console.log(e)})),w.src=G.value,m(J)})),j.addEventListener("click",(function(){z.reset(),s(z),d(J)})),fetch("".concat(y.baseUrl,"/users/me"),{method:"GET",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))})).then((function(e){var t=/[^A-Za-zА-ЯЁа-яё\- ]/g;B.textContent=e.name.replace(t,""),T.textContent=e.about.replace(t,""),w.src=e.avatar,fetch("".concat(y.baseUrl,"/cards"),{method:"GET",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))})).then((function(e){var t="server",n=!1;e.forEach((function(e){t=e.owner.name===B.textContent?"own":"server",e.likes.forEach((function(e){e.name===B.textContent&&(n=!0)})),M.append(S(Z,e._id,e.name,e.link,e.likes.length,t,n)),n=!1}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}));var M=document.querySelector(".elements"),Z=document.querySelector("#card-template").content;document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",_)}));var F=document.querySelector(".new-item"),I=document.querySelector(".new-item__form"),K=document.querySelector(".new-item__submit"),Q=I.querySelector('input[name="item-text"]'),R=I.querySelector('input[name="item-link"]');I.addEventListener("submit",(function(e){var t;e.preventDefault(),f(K),(t={name:Q.value,link:R.value},fetch("".concat(y.baseUrl,"/cards"),{method:"POST",headers:y.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))}))).then((function(e){M.prepend(S(Z,e._id,e.name,e.link,e.likes.length,"own")),v(K),setTimeout((function(){h(K)}),1e3),m(F),I.reset()})).catch((function(e){console.log(e)}))}));var W=A.querySelector(".profile__add-button");O.addEventListener("submit",(function(e){var t;e.preventDefault(),B.textContent!==V.value||T.textContent!==N.value?(B.textContent=V.value,T.textContent=N.value,f(D),(t={name:V.value,about:N.value},fetch("".concat(y.baseUrl,"/users/me"),{method:"PATCH",headers:y.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))}))).then((function(e){m(U),v(D),setTimeout((function(){h(D)}),1e3)})).catch((function(e){console.log(e),h(D)}))):m(U)})),P.addEventListener("click",(function(){O.reset(),s(O),V.value=B.textContent,N.value=T.textContent,d(U)})),W.addEventListener("click",(function(){I.reset(),s(I),d(F)})),u({formSelector:'.popup__form[name="form-edit-profile"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!0}),u({formSelector:'.popup__form[name="form-new-item"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!1}),u({formSelector:'.popup__form[name="form-update-avatar"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",validationAtOpen:!0})})();